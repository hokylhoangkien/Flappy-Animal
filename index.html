<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Flappy Animal</title>

    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#a2d2ff" />

    <script>
      // üîπ ƒêƒÉng k√Ω Service Worker
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("sw.js")
            .then(() => console.log("‚úÖ Service Worker registered"))
            .catch((err) => console.log("‚ùå SW failed:", err));
        });
      }

      // üîπ Bi·∫øn l∆∞u s·ª± ki·ªán c√†i ƒë·∫∑t
      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const installBtn = document.getElementById("installBtn");
        installBtn.style.display = "inline-block";

        installBtn.addEventListener("click", async () => {
          installBtn.style.display = "none";
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log("User response to install:", outcome);
          deferredPrompt = null;
        });
      });

      // üîπ N·∫øu app ƒë√£ ƒë∆∞·ª£c c√†i
      window.addEventListener("appinstalled", () => {
        console.log("‚úÖ App installed successfully");
      });
    </script>
  </head>

  <body>
    <div class="topbar">
      <div class="brand">Flappy <span class="accent">Animal</span></div>
      <div class="controls">
        <button id="shopBtn" class="btn">Shop ƒê·ªông v·∫≠t</button>
        <button id="muteBtn" class="btn">T·∫Øt nh·∫°c</button>
        <button id="restartBtn" class="btn">Restart</button>
        <div class="scorewrap">
          Score: <span id="score">0</span> | Highscore:
          <span id="highscore">0</span>
        </div>
      </div>
    </div>

    <main class="game-wrap">
      <canvas
        id="canvas"
        width="420"
        height="640"
        aria-label="Flappy Duck game"
      ></canvas>
      <div id="overlayMsg" class="overlay">
        Nh·∫•n <b>Space</b> ho·∫∑c <b>Click</b> ƒë·ªÉ b·∫Øt ƒë·∫ßu
      </div>
    </main>

    <!-- üîπ N√∫t C√†i ƒë·∫∑t ·ª©ng d·ª•ng -->
    <div style="text-align: center; margin: 20px">
      <button
        id="installBtn"
        class="btn"
        style="display: none; background: #fcbf49; color: #000"
      >
        üì≤ C√†i ƒë·∫∑t ·ª©ng d·ª•ng
      </button>
    </div>

    <!-- Shop modal -->
    <div id="shopModal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal-card">
        <header>
          <h2>Ch·ªçn ƒë·ªông v·∫≠t</h2>
          <button id="closeShop" class="icon-btn">‚úï</button>
        </header>
        <section class="duck-grid" id="duckList"></section>
      </div>
    </div>

    <!-- √Çm thanh -->
    <audio id="sfxFlap" src="audio/flap.mp3"></audio>
    <audio id="sfxScore" src="" preload="auto"></audio>
    <audio id="sfxHit" src="audio/hit.mp3" preload="auto"></audio>
    <audio id="bgMusic" src="audio/background.mp3" preload="auto" loop></audio>

    <footer class="credit">Made with ‚ù§Ô∏è by <span>Phan Ho√†ng Ki√™n</span></footer>

    <script src="game.js"></script>
  </body>
</html>
